#+STARTUP: noinlineimages

* Treemacs - a tree layout file explorer for Emacs

[[file:screenshot.png]]

* Content                                                                            :TOC:noexport:
 - [[#treemacs---a-tree-layout-file-explorer-for-emacs][Treemacs - a tree layout file explorer for Emacs]]
 - [[#feature-overview][Feature Overview]]
 - [[#installation][Installation]]
 - [[#configuration][Configuration]]
   - [[#variables][Variables]]
   - [[#faces][Faces]]
   - [[#treemacs-follow-mode][Treemacs-follow-mode]]
   - [[#session-persistence][Session persistence]]
   - [[#terminal-compatibility][Terminal Compatibility]]
 - [[#keymap][Keymap]]
 - [[#dependencies][Dependencies]]

* Feature Overview

Treemacs is a file and project explorer in the same vein as NeoTree or vim's NerdTree. It shows the file system outline in a
simple tree layout allowing quick navigation and exploration, while also possessing *basic* file management utilities.
Specifically a quick feature overview looks as follows:

 * Easy navigation - quickly change the root directory or use shortcuts to jump to parent or neighbouring nodes.
 * Versatile file access - decide exactly how and where a file will be opened, including using ~ace-window~ to choose
   a buffer or launch an external app via ~xdg-open~
 * Optionally always follow along and keep in focus the currently selected file ~treemacs-follow-mode~
 * Optional git integration - treemacs will use different faces for files based on their git status.
   The git process runs asynchronously and so won't cause any perceptible delay.
 * [[https://github.com/deb0ch/emacs-winum][Winum]] integration - treemacs will always be assigned window number 10, never interfering with the numbering
   layout of your other windows.
 * Projectile integration - quickly open treemacs at any known project's root directory.
 * Dashing good looks - treemacs uses genuine png images in HD 22x22 resolution for its icons (quantity is, of course,
   another matter). When run in a terminal a very simple fallback is used.
 * Session persistence with ~desktop-save-mode~
 * Ease of use - treemacs offers many configuration options, but comes with a set of (what hopefully should be) sane
   defaults. Installation aside there are two obligatory pieces of setup: 1) Choosing convenient keybindings to run
   treemacs and 2) If you use evil: requiring ~treemacs-evil~ to integrate treemacs with evil and enable j/k navigation.
   More on both below.

* Installation

Treemacs is not available on MEPLA just yet (though I do plan to publish soon). If you want to use it anyway installtion
has to be done the oldfashioned way - clone the repository, add it to your ~loadpath~, and ~require~ it. Also require
~treemacs-evil~ if you use evil-mode.

Once this is done treemacs is ready to be used by calling ~treemacs~, ~treemacs-toggle~ or
~treemacs-projectile~.

* Configuration
** Variables
Treemacs offers the following configuration options:

| Variable                            | Default                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| treemacs-indentation                | 2                                     | The number of spaces each level is indented in the tree.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| treemacs-width                      | 35                                    | Width of the treemacs buffer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| treemacs-show-hidden-files          | t                                     | Dotfiles will be shown if this is set to t and be hidden otherwise.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| treemacs-header-function            | treemacs--create-header               | The function which is used to create the header string for treemacs buffers. Default options are ~treemacs--create-header~ and ~treemacs--create-header-projectile~. Any function that takes the current root path and returns the header string may be used.                                                                                                                                                                                                                                                                                                                                                                                                            |
| treemacs-git-integration            | nil                                   | When t use different faces for files' different git states.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| treemacs-follow-after-init          | nil                                   | When t follow the currently selected file after initializing the treemacs buffer, regardless of ~treemacs-follow-mode~ setting.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| treemacs-change-root-without-asking | nil                                   | When t don't ask to change the root when calling ~treemacs-find-file~.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| treemacs-never-persist              | nil                                   | When t treemacs will never persist its state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| treemacs-sorting                    | alphabetic-asc                        | Indicates how treemeacs will sort its files and directories. Files will still always be shown after directories. Valid values are ~alphabetic-asc~, ~alphabetic-desc~, ~size-asc~, ~size-desc~, ~mod-time-asc~, ~mod-time-desc~.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| treemacs-ignored-file-predicates    | (treemacs--std-ignore-file-predicate) | List of predicates to test for files ignored by Emacs. Ignored files will *never* be shown in the treemacs buffer (unlike dotfiles) whose presence is controlled by ~treemacs-show-hidden-files~). Each predicate is a function that takes the filename as its only argument and returns t if the file should be ignored and nil otherwise. A file whose name returns t for *any* function in this list counts as ignored. By default this list contains ~treemacs--std-ignore-file-predicate~ which filters out '.', '..', Emacs' lock files as well as flycheck's temp files, and therefore should not be directly overwritten, but added to and removed from instead. |

** Faces

Treemacs defines and uses the following faces:
| Face                    | Inherits from                                   | Description                                                                  |
|-------------------------+-------------------------------------------------+------------------------------------------------------------------------------|
| treemacs-directory-face | font-lock-function-name-face                    | Face used for directories.                                                   |
| treemacs-file-face      | default                                         | Face used for files.                                                         |
| treemacs-header-face    | font-lock-constant-face (underlined & size 1.4) | Face used for the treemacs header.                                           |
| treemacs-term-node-face | font-lock-string-face                           | Face for directory node symbols used by treemacs when it runs in a terminal. |
| treemacs-git-*-face     | various font lock faces                         | Faces used by treemacs for various git states.                               |

** Treemacs-follow-mode

~treemacs-follow-mode~ is a minor mode which allows the treemacs view to always move its focus to the
currently selected file. This is achieved by advising ~select-window~, which is a ubiquitous function, often called
multiple times in a row when emacs is working. This means two things:

1) ~treemacs-follow~ tries to be very specific about when it is run at all.

2) There may be times when something slips through (~which-key~ for exmaple would cause such a problem if treemacs
wasn't made compatible with it by default). If you do see ~treemacs-follow~ behaving in a way it shouldn't open up
an issue. The fix shouldn't be more than a single bit of advice away.

** Session persistence
To persist treemacs state beyond emacs' shutdown treemacs offers integration with the builtin
~desktop-save-mode~. This integration shoud work out of the box and require zero setup and configuration
(aside from the option to turn it off with ~treemacs-never-persist~).

The persisted state is saved under ~user-emacs-directory/.cache/treemacs-persist~. The exact file location
is saved in the variable ~treemacs--persist-file~.

Persistence by means of frameworks other than ~desktop-save-mode~ is likewise possible, but does require
some additional work. To save treemacs' current state ~treemacs-persist~ must be called. By default this would
happen in ~desktop-save-hook~, in its absence it must be invoked elsewhere. If all else fails ~emacs-kill-hook~
is a good candidate to run persistence.

State restoration should again work automatically. When the treemacs major mode is toggled in a completely empty
buffer (this should normally never happen, as even an empty directory still contains a header) ~treemacs-restore~
will be called and the previously saved state (if available) will be restored. If this does not work it is of course
still possible to invoke ~treemacs-restore~ manually when the right conditions are met.

** Terminal Compatibility
When run in a terminal treemacs will fall back to a much simpler rendering system, foregoing its usual png icons and using
simple ~+~ and ~-~ characters instead. Changes to the current rendering system are detected automatically - within some
limits. The check for the change happens with treemacs' functions which build or show/hide the treemacs buffer, namely
~treemacs(-projectile)~. ~treemacs-toggle~ and ~treemacs-refresh~.
* Keymap

Activation functions are unbound by default. It's left up to users to find the most convenient key binds.
Additionally ~treemacs-refresh~ and ~treemacs-find-file~ may also be called from outside the treemacs window and
might therefore need their own global binding.

| Action              | Description                                                                                                                                                                                                                                                                              |
|---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| treemacs            | Open treemacs with current buffer's directory as root. If the current buffer is not visiting any files use $HOME as fallback. If a prefix argument is given manually select the root directory.                                                                                          |
| treemacs-projectile | Open treemacs for the current projectile project. If not in a project do nothing. If a prefix argument is given select the project from among ~projectile-known-projects~.                                                                                                               |
| treemacs-toggle     | If a treemacs buffer exists and is visible hide it. If a treemacs buffer exists, but is not visible bring it to the foreground and select it. If no treemacs buffer exists call treemacs.                                                                                                |
| treemacs-find-file  | Find and move point to PATH (or the current file) in the treemacs buffer. Expand folders if needed. If PATH is not under the current root ask to change the root. If not treemacs buffer exists create it. Do nothing if PATH is not given and the current buffer is not editing a file. |

By default Treemacs's keymap looks as follows:

| Key     | Action                                   | Description                                                                                                                           |
|---------+------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------|
| j/n     | treemacs-next-line                       | Goto next/prev line.                                                                                                                  |
| h       | treemacs-uproot                          | Switch treemacs' root directory to current root's parent, if possible.                                                                |
| l       | treemacs-change-root                     | Use currently selected directory as new root. Do nothing for files.                                                                   |
| M-j/M-n | treemacs-next/previous-neighbour         | Select next node at the same depth as currently selected node, if possible.                                                           |
| th      | treemacs-toggle-show-dotfiles            | Toggle the hiding and displaying of dotfiles.                                                                                         |
| tw      | treemacs-toggle-fixed-width              | Toggle whether the treemacs buffer should have a fixed width. See also treemacs-width.                                                |
| tf      | treemacs-follow-mode                     | Toggle treemacs-follow-mode (see above).                                                                                              |
| w       | treemacs-reset-width                     | Reset the width of the treemacs buffer to treemacs-width. If a prefix argument is provided read a new value for treemacs-width first. |
| tab     | treemacs-push-button                     | Open/close directory. Open file with treemacs-visit-file-vertical-split.                                                              |
| g/r     | treemacs-refresh                         | Refresh and rebuild treemacs buffer.                                                                                                  |
| d       | treemacs-delete                          | Delete node at point. A delete action must always be confirmed. Directories are deleted recursively.                                  |
| cf      | treemacs-create-file                     | Create a file.                                                                                                                        |
| cd      | treemacs-create-dir                      | Create a directory.                                                                                                                   |
| u       | treemacs-goto-parent-node                | Select parent of selected node, if possible.                                                                                          |
| q       | treemacs-toggle                          | Hide/show an existing treemacs buffer. Create one if it does not exist.                                                               |
| Q       | treemacs-kill-buffer                     | Kill the treemacs buffer.                                                                                                             |
| ov      | treemacs-visit-file-vertical-split       | Open current file by vertically splitting other-buffer. Do nothing for directories.                                                   |
| oh      | treemacs-visit-file-horizontal-split     | Open current file by horizontally splitting other-buffer. Do nothing for directories.                                                 |
| oo/RET  | treemacs-visit-file-no-split             | Open current file, performing no split and using other-buffer directly. Do nothing for directories.                                   |
| oaa     | treemacs-visit-file-ace                  | Open current file, using ace-window to decide which buffer to open the file in. Do nothing for directories.                           |
| oah     | treemacs-visit-file-ace-horizontal-split | Open current file by horizontally splitting a buffer selected by ace-window. Do nothing for directories.                              |
| oav     | treemacs-visit-file-ace-vertical-split   | Open current file by vertically splitting a buffer selected by ace-window. Do nothing for directories.                                |
| ox      | treemacs-xdg-open                        | Open current file, using the xdg-open shell-command. Do nothing for directories.                                                      |
| yy      | treemacs-yank-path-at-point              | Copy the absolute path of the node at point.                                                                                          |
| yr      | treemacs-yank-root                       | Copy the absolute path of the current treemacs root.                                                                                  |
* Dependencies
 * emacs >= 24.4
 * f.el
 * s.el
 * dash
 * cl-lib
 * ace-window
 * pfuture
 * (optionally) evil
 * (optionally) projectile
 * (optionally) winum
